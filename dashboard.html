<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Luartor - Super Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    @keyframes fadeIn {
      0% {opacity:0;}
      100% {opacity:1;}
    }
    @keyframes pulse {
      0%,100% {transform:scale(1);}
      50% {transform:scale(1.05);}
    }
    :root {
      --primary: #4f46e5;
      --secondary: #06b6d4;
      --dark-bg: #0f172a;
      --light-text: #f8fafc;
      --accent: #6366f1;
      --input-bg: #1e293b;
      --input-border: #334155;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }
    * {
      box-sizing: border-box;
      user-select:none;
    }
    body,html {
      margin:0;
      min-height:100vh;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(270deg, #1e293b, #0f172a, #334155);
      background-size: 600% 600%;
      animation: gradientBG 20s ease infinite;
      color: var(--light-text);
      display:flex;
      flex-direction: column;
    }
    header {
      background: rgba(15, 23, 42, 0.85);
      padding: 20px 36px;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      user-select:none;
      box-shadow: 0 6px 18px rgba(79, 70, 229, 0.4);
    }
    main {
      flex-grow: 1;
      padding: 24px 36px;
      max-width: 1000px;
      margin: auto;
      animation: fadeIn 0.8s ease forwards;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    #companyTitle {
      font-weight: 600;
      font-size: 1.4rem;
      user-select:none;
    }
    .tabs {
      display: flex;
      gap: 24px;
      border-bottom: 2px solid var(--input-border);
      user-select:none;
    }
    .tab {
      cursor: pointer;
      font-weight: 600;
      font-size: 1.15rem;
      padding-bottom: 8px;
      border-bottom: 3px solid transparent;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    .tab.active {
      border-color: var(--secondary);
      color: var(--secondary);
    }
    section.content {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 12px 36px rgba(0,0,0,0.5);
      flex-grow: 1;
      overflow-y: auto;
      max-height: 65vh;
    }
   
    .key-gen-area {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 16px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(79, 70, 229, 0.6);
      user-select:none;
      transition: background 0.4s ease;
      flex-shrink: 0;
      white-space: nowrap;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      box-shadow: 0 8px 28px rgba(6, 182, 212, 0.8);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow:none;
    }
    .key-display {
      background: var(--input-bg);
      padding: 18px 22px;
      border-radius: 16px;
      font-family: monospace;
      font-size: 1.2rem;
      user-select: text;
      color: var(--light-text);
      box-shadow: inset 0 0 12px #0006;
      min-width: 260px;
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .copy-btn {
      background: var(--secondary);
      border: none;
      border-radius: 10px;
      color: white;
      padding: 8px 18px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      user-select:none;
      box-shadow: 0 4px 12px rgba(6,182,212,0.7);
      margin-left: 8px;
      flex-shrink: 0;
      transition: background 0.3s ease;
    }
    .copy-btn:hover {
      background: var(--primary);
    }
    .key-list {
      max-height: 320px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .key-item {
      padding: 12px 16px;
      border-radius: 12px;
      background: var(--input-bg);
      margin-bottom: 10px;
      font-family: monospace;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: inset 0 0 5px #0004;
      user-select: text;
    }
    .key-item button.delete-key {
      background: #ef4444;
      border: none;
      border-radius: 12px;
      color: white;
      padding: 6px 16px;
      cursor: pointer;
      user-select:none;
      font-weight: 700;
      font-size: 0.85rem;
      transition: background 0.3s ease;
    }
    .key-item button.delete-key:hover {
      background: #b91c1c;
    }
  
    #scriptsManagerContainer {
      display: flex;
      flex-direction: column;
      gap: 20px;
      color: var(--light-text);
    }
    .script-card {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      color: #f8fafc;
      user-select:text;
    }
    .script-header {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select:none;
    }
    .script-header button.delete-script {
      background: #ef4444;
      border: none;
      border-radius: 12px;
      color: white;
      padding: 6px 14px;
      cursor: pointer;
      user-select:none;
      font-weight: 700;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }
    .script-header button.delete-script:hover {
      background: #b91c1c;
    }
    textarea.lua-editor {
      flex-grow: 1;
      background: #1e293b;
      border: 2px solid #334155;
      border-radius: 12px;
      color: #f8fafc;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      resize: vertical;
      min-height: 180px;
      user-select:text;
      margin-bottom: 12px;
    }
    label.key-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      user-select:none;
      font-weight: 600;
    }
    button.save-script-btn {
      padding: 12px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      font-weight: 700;
      cursor: pointer;
      user-select:none;
      align-self: flex-start;
      transition: background 0.4s ease;
    }
    button.save-script-btn:hover {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
    }
    button.add-script-btn {
      padding: 18px 0;
      border-radius: 18px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border: none;
      color: white;
      font-weight: 700;
      font-size: 1.25rem;
      cursor: pointer;
      user-select:none;
      box-shadow: 0 6px 18px rgba(79, 70, 229, 0.6);
      transition: box-shadow 0.3s ease;
      max-width: 200px;
      margin-top: 10px;
      align-self: center;
    }
    button.add-script-btn:hover {
      box-shadow: 0 8px 24px rgba(6, 182, 212, 0.8);
    }
    .status-msg {
      font-weight: 600;
      font-size: 1rem;
      margin-top: 10px;
      user-select:none;
      min-height: 1.2rem;
    }
    .status-success {
      color: var(--success);
    }
    .status-error {
      color: var(--error);
    }
    .footer {
      padding: 16px 0;
      text-align: center;
      color: #64748b;
      font-size: 0.85rem;
      user-select:none;
    }
  </style>
</head>
<body>
  <header>Luartor Super Dashboard</header>
  <main aria-label="Dashboard Main Content">
    <div id="companyTitle" aria-live="polite"></div>
    <nav class="tabs" role="tablist" aria-label="Dashboard Tabs">
      <button class="tab active" role="tab" aria-selected="true" aria-controls="keysPanel" id="tabKeys">Keys</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="scriptsPanel" id="tabScripts">Scripts</button>
    </nav>
    <section id="keysPanel" class="content" role="tabpanel" aria-labelledby="tabKeys" tabindex="0">
      <div class="key-gen-area">
        <button class="btn-primary" id="generateKeyBtn" aria-label="Generate new key">Generate New Key</button>
        <div tabindex="0" class="key-display" id="newKeyDisplay" aria-live="polite" aria-atomic="true" aria-label="Generated key display"></div>
        <button class="copy-btn" id="copyNewKeyBtn" aria-label="Copy generated key" title="Copy Key" disabled>Copy</button>
      </div>
      <div class="key-list" id="keyList" aria-live="polite" aria-atomic="true" aria-label="List of generated keys"></div>
      <div id="keyStatusMsg" class="status-msg" role="alert" aria-live="assertive"></div>
    </section>
    <section id="scriptsPanel" class="content" role="tabpanel" aria-labelledby="tabScripts" tabindex="0" hidden>
      <div id="scriptsManagerContainer" aria-live="polite" aria-atomic="true"></div>
      <button class="add-script-btn" id="addScriptBtn" aria-label="Add new script">+ Add Script</button>
      <div id="scriptStatusMsg" class="status-msg" role="alert" aria-live="assertive"></div>
    </section>
  </main>
  <div class="footer">Â© 2025 Luartor by TheBestDragon</div>
<script>
(() => {
  const urlParams = new URLSearchParams(window.location.search);
  const company = urlParams.get('company') || 'default';
  const keyFromURL = urlParams.get('key') || '';
  const companyTitle = document.getElementById('companyTitle');
  const keyListEl = document.getElementById('keyList');
  const newKeyDisplay = document.getElementById('newKeyDisplay');
  const copyNewKeyBtn = document.getElementById('copyNewKeyBtn');
  const generateKeyBtn = document.getElementById('generateKeyBtn');
  const keyStatusMsg = document.getElementById('keyStatusMsg');
  const scriptStatusMsg = document.getElementById('scriptStatusMsg');
  const tabs = document.querySelectorAll('.tab');
  const keysPanel = document.getElementById('keysPanel');
  const scriptsPanel = document.getElementById('scriptsPanel');
  const scriptsManagerContainer = document.getElementById('scriptsManagerContainer');
  const addScriptBtn = document.getElementById('addScriptBtn');

  const maxKeysPerCompany = 30;
  const maxScripts = 6;

  companyTitle.textContent = `Company: ${company}`;


  let keyStore = JSON.parse(localStorage.getItem('luartor_keys') || '{}');
  if(!keyStore[company]) keyStore[company] = [];

  let scripts = JSON.parse(localStorage.getItem(`luartor_scripts_${company}`) || '[]');


  function saveKeyStore() {
    localStorage.setItem('luartor_keys', JSON.stringify(keyStore));
  }
  function saveScripts() {
    localStorage.setItem(`luartor_scripts_${company}`, JSON.stringify(scripts));
  }


  function showStatus(msg, isSuccess=true, forScript=false) {
    const el = forScript ? scriptStatusMsg : keyStatusMsg;
    el.textContent = msg;
    el.className = 'status-msg ' + (isSuccess ? 'status-success' : 'status-error');
    setTimeout(() => {
      el.textContent = '';
      el.className = 'status-msg';
    }, 4000);
  }

  // KEYS PANEL LOGIC
  function renderKeyList() {
    keyListEl.innerHTML = '';
    if(keyStore[company].length === 0) {
      const p = document.createElement('p');
      p.textContent = 'No keys generated yet.';
      p.style.color = '#94a3b8';
      p.style.userSelect = 'none';
      keyListEl.appendChild(p);
      return;
    }
    keyStore[company].forEach((key,i) => {
      const div = document.createElement('div');
      div.className = 'key-item';
      const keySpan = document.createElement('span');
      keySpan.textContent = key;
      keySpan.setAttribute('tabindex', '0');
      keySpan.style.userSelect = 'text';
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.className = 'delete-key';
      delBtn.title = 'Delete key';
      delBtn.onclick = () => {
        keyStore[company].splice(i,1);
        saveKeyStore();
        renderKeyList();
        showStatus('Key deleted', true);
      };
      div.appendChild(keySpan);
      div.appendChild(delBtn);
      keyListEl.appendChild(div);
    });
  }
  function generateNewKey() {
    if(keyStore[company].length >= maxKeysPerCompany) {
      showStatus(`Maximum of ${maxKeysPerCompany} keys reached`, false);
      return null;
    }
    const arr = new Uint8Array(16);
    crypto.getRandomValues(arr);
    const key = Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
    keyStore[company].push(key);
    saveKeyStore();
    return key;
  }
  generateKeyBtn.addEventListener('click', () => {
    const newKey = generateNewKey();
    if(!newKey) return;
    newKeyDisplay.textContent = newKey;
    copyNewKeyBtn.disabled = false;
    showStatus('New key generated', true);
  });
  copyNewKeyBtn.addEventListener('click', () => {
    const key = newKeyDisplay.textContent;
    if(!key) return;
    navigator.clipboard.writeText(key).then(() => {
      showStatus('Copied to clipboard!', true);
    }).catch(() => {
      showStatus('Failed to copy.', false);
    });
  });


  function switchTab(selectedId) {
    tabs.forEach(tab => {
      const isSelected = tab.id === selectedId;
      tab.classList.toggle('active', isSelected);
      tab.setAttribute('aria-selected', isSelected ? 'true' : 'false');
    });
    keysPanel.hidden = selectedId !== 'tabKeys';
    scriptsPanel.hidden = selectedId !== 'tabScripts';
  }
  tabs.forEach(tab => {
    tab.addEventListener('click', () => switchTab(tab.id));
  });


  function createScriptCard(idx, script) {
    const card = document.createElement('div');
    card.className = 'script-card';

    const header = document.createElement('div');
    header.className = 'script-header';
    header.textContent = `Script #${idx + 1}`;

    const delBtn = document.createElement('button');
    delBtn.className = 'delete-script';
    delBtn.textContent = 'Delete';
    delBtn.title = 'Delete script';
    delBtn.onclick = () => {
      scripts.splice(idx, 1);
      saveScripts();
      renderScripts();
      showStatus('Script deleted', true, true);
    };
    header.appendChild(delBtn);
    card.appendChild(header);

    const textarea = document.createElement('textarea');
    textarea.className = 'lua-editor';
    textarea.value = script.content || '';
    textarea.placeholder = 'Paste your Lua script here...';
    textarea.spellcheck = false;
    textarea.addEventListener('input', e => {
      scripts[idx].content = e.target.value;
      saveScripts();
    });
    card.appendChild(textarea);

    const label = document.createElement('label');
    label.className = 'key-toggle';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = !!script.keySystem;
    checkbox.addEventListener('change', e => {
      scripts[idx].keySystem = e.target.checked;
      saveScripts();
      renderScripts();
      showStatus(`Key System ${e.target.checked ? 'enabled' : 'disabled'}`, true, true);
    });
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(' Add Key System to Script'));
    card.appendChild(label);

    const saveBtn = document.createElement('button');
    saveBtn.className = 'save-script-btn';
    saveBtn.textContent = 'Save Script';
    saveBtn.onclick = () => {
      saveScripts();
      showStatus('Script saved', true, true);
    };
    card.appendChild(saveBtn);


    if(script.keySystem) {
      textarea.value = injectKeySystem(script.content || '');
    }

    return card;
  }

  function injectKeySystem(scriptText) {
    const snippet = `
local validKeys = {
  "REPLACE_KEYS_HERE"
}
local function checkKey(key)
  for _, k in pairs(validKeys) do
    if k == key then return true end
  end
  return false
end
local userKey = "ENTER_YOUR_KEY_HERE"
if not checkKey(userKey) then
  error("Invalid key. Access denied.")
end
`;
    let keysArray = keyStore[company].map(k => `"${k}"`);
    let keysStr = keysArray.join(", ");
   
    const snippetStart = snippet.split("\n")[0].trim();
    if(scriptText.includes(snippetStart)) {
      scriptText = scriptText.replace(new RegExp(`local validKeys = {[^}]+}`, 's'), `local validKeys = {${keysStr}}`);
      return scriptText;
    }
    return snippet.replace("REPLACE_KEYS_HERE", keysStr).replace("ENTER_YOUR_KEY_HERE", keyFromURL || '');
  }

  function renderScripts() {
    scriptsManagerContainer.innerHTML = '';
    if(scripts.length === 0) {
      const p = document.createElement('p');
      p.textContent = 'No scripts uploaded yet.';
      p.style.textAlign = 'center';
      p.style.color = '#94a3b8';
      p.style.userSelect = 'none';
      scriptsManagerContainer.appendChild(p);
    } else {
      scripts.forEach((s,i) => {
        scriptsManagerContainer.appendChild(createScriptCard(i,s));
      });
    }
    addScriptBtn.disabled = scripts.length >= maxScripts;
  }

  addScriptBtn.onclick = () => {
    if(scripts.length >= maxScripts) return;
    scripts.push({content: '', keySystem: false});
    saveScripts();
    renderScripts();
    showStatus('New script added', true, true);
  };

  renderKeyList();
  renderScripts();
  switchTab('tabKeys');
})();
</script>
</body>
</html>
